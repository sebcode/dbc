dropbox clone plan
------------------

file in 1 mb chunks splitten
jedes chunk hat md4 hash
chunk hashes in sqlite speichern
chunks zusammengerechnet (mit xor?) ergibt file hash
chunk wird auch nochmal gesplittet in 8x 128 KB minichunks
minichunks werden bei bedarf berechnet

module:

* indexer : indiziert dateien, berechnet hashes, pflegt sqlite db
wenn sich mtime aendert, wird neu berechnet

* monitor: ueberwacht verzeichnis nach changes
passiert change, wird indexer angeworfen

* netserver: bearbeitet client-anfragen
getfilelist: gib mir fileliste (etag-aware)
getchunklist: gib mir liste von chunk-hashes fuer eine datei
getchunk: gib mir chunk daten (etag)
getminichunklist: gib mir minichunk-hashes fuer einen chunk
getminichunk: gib mir daten fuer einen minichunk (etag)
putchunk: chunk fuer eine datei setzen
	params: filesum, chunksum, chunksize, data
needchunk: welchen chunk brauchst du?
	params: filesum
	result: 
		NONE
		chunknum, chunksum

* netclient: kommuniziert mit server


sqlitedb:

files
-----
id
name
size
hash

files_chunks
------------
file_id
chunk_id
pos

chunks
------
id
hash
size (1024 oder weniger)

xxxxxxxxxxxx
AAABBBCCCDD

numchunks = 4
chunksize = 3
size = 11
maxsize = numchunks * chunksize = 4 * 3 = 12
lastchunksize = maxsize - size

xxx
A

numchunks = 1
chunksize = 3
size = 1
maxsize = 1 * 3 = 3
lastchunksize = 3 - 1 = 2


--------------

ablauf

client macht diff von fileliste mit lokalen dateien, als local-diff merken
	lokale dateien:
		test1.txt
		test2.txt
	fileliste:
		test1.txt
		test3.txt
	diff:
		A test2.txt
		D test3.txt
client connected zu server
client holt fileliste
client vergleicht remote-filelist mit lokalen dateien
	lokale dateien:
		test1.txt
		test2.txt
	remote-filelist
		test1.txt
		test4.txt
	diff:
		A test4.txt
		D test2.txt
diff durchgehen
	test4.txt ist neu, herunterladen
	test2.txt existiert remote nicht mehr
		frage: darf sie lokal geloescht werden?
			ja, denn sie ist in local-diff auch als geloescht markiert (achtung: nur wenn md5 gleich ist)
			ansonsten nein, und als neu betrachten und hochladen

